<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ú–æ–π –ü—Å–∏—Ö–æ–ª–æ–≥</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  
  <style>
    :root {
      /* –§–æ–Ω –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
      --bg-color: #F3F6F8;
      
      /* –ï–¥–∏–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ */
      --text-main: #2C3E50;
      --text-secondary: #546E7A;
      
      /* –¶–≤–µ—Ç–∞ —á–∞—Ç–∞ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª) */
      --bot-msg-bg: #FFFFFF;
      --user-msg-bg: #5D9CEC;
      --user-msg-text: #FFFFFF;
      
      /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --card-blue-bg: linear-gradient(135deg, #89C4F4 0%, #5D9CEC 100%);
      --card-green-bg: linear-gradient(135deg, #A8E6CF 0%, #DCEDC8 100%);
      --card-gray-bg: linear-gradient(135deg, #E6E9F0 0%, #EEF1F5 100%);
      --card-white-bg: #FFFFFF;

      /* –î—ã—Ö–∞–Ω–∏–µ */
      --breath-inhale: #89C4F4;
      --breath-hold: #5D9CEC;
      --breath-exhale: #E2E8F0;
    }

    /* –°–±—Ä–æ—Å –∏ –±–∞–∑–∞ */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      display: flex; flex-direction: column;
    }

    /* --- –®–ê–ü–ö–ê –ù–ê–í–ò–ì–ê–¶–ò–ò (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–æ–≤) --- */
    header {
      padding: 0 15px;
      background: #FFFFFF;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      z-index: 100;
      display: none; /* –°–∫—Ä—ã—Ç–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é */
      align-items: center;
      height: 50px;
      flex-shrink: 0;
      width: 100%;
    }

    #back-btn {
      background: none; border: none; color: var(--text-main);
      cursor: pointer; padding: 5px; display: flex; align-items: center;
    }
    .header-title { font-size: 16px; font-weight: 600; margin-left: 10px; }

    /* --- –≠–ö–†–ê–ù–´ --- */
    .screen {
      flex: 1; display: none; flex-direction: column; width: 100%; height: 100%;
      overflow: hidden; position: relative;
    }
    .screen.active { display: flex; animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* --- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ --- */
    #menu-screen {
      /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ–±—ã –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª –æ—Ç –∫—Ä–∞—è –¥–æ –∫—Ä–∞—è */
      padding: 0; 
      background-color: var(--bg-color);
      overflow-y: auto;
    }

    /* –ë–õ–û–ö –ü–†–û–§–ò–õ–Ø (–í–µ—Ä—Ö–Ω–∏–π –±–∞–Ω–Ω–µ—Ä) */
    .profile-section {
      background: white;
      width: 100%;
      padding: 25px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }

    .profile-placeholder-img {
      width: 60px; height: 60px;
      background-color: #E0E0E0;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .profile-info h2 { 
      font-size: 18px; 
      font-weight: 700; 
      color: var(--text-main); 
      margin-bottom: 4px; 
    }
    .profile-info p { 
      font-size: 14px; 
      color: #2ECC71; /* –ó–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç "–û–Ω–ª–∞–π–Ω" */
      font-weight: 500; 
      display: flex; align-items: center; gap: 5px; 
    }

    /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö –ú–ï–ù–Æ */
    .menu-list {
      padding: 0 15px 20px 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .menu-card {
      border-radius: 20px;
      padding: 24px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      cursor: pointer;
      min-height: 100px;
    }
    .menu-card:active { transform: scale(0.98); transition: transform 0.1s; }

    /* –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .menu-content h3 { 
      font-size: 17px; 
      font-weight: 700; 
      margin-bottom: 4px; 
      color: #333333; /* –í—Å–µ–≥–¥–∞ —Ç–µ–º–Ω—ã–π */
    }
    .menu-content p { 
      font-size: 13px; 
      font-weight: 400; 
      color: #555555; /* –í—Å–µ–≥–¥–∞ —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
    }

    /* –ò–∫–æ–Ω–∫–∏ */
    .menu-card .icon-circle {
      width: 48px; height: 48px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255, 255, 255, 0.4);
      flex-shrink: 0;
    }
    .menu-card .icon-circle span { font-size: 26px; }

    /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ */
    
    /* –ß–∞—Ç */
    .card-chat { background: var(--card-blue-bg); }
    .card-chat .icon-circle span { color: #FFFFFF; }
    .card-chat h3, .card-chat p { color: white !important; } /* –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –≤ —Å–∏–Ω–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–µ–∫—Å—Ç –±–µ–ª—ã–π */

    /* –ú–µ–¥–∏—Ç–∞—Ü–∏–∏ */
    .card-video { background: var(--card-green-bg); }
    .card-video .icon-circle span { color: #27AE60; }

    /* –î—ã—Ö–∞–Ω–∏–µ */
    .card-game { background: var(--card-gray-bg); }
    .card-game .icon-circle { background: #FFFFFF; }
    .card-game .icon-circle span { color: #5D9CEC; }

    /* –î–Ω–µ–≤–Ω–∏–∫ (–°–≤–µ—Ç–ª–∞—è, –ø–æ—á—Ç–∏ –±–µ–ª–∞—è) */
    .card-music { background: #FFFFFF; border: 1px solid #EAEAEA; }
    .card-music .icon-circle { background: #F5F7FA; }
    .card-music .icon-circle span { color: #E74C3C; }

    /* --- –ß–ê–¢ (–í–æ–∑–≤—Ä–∞—Ç –∫ –∫–ª–∞—Å—Å–∏–∫–µ) --- */
    #chat-container { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #F0F2F5; }
    
    .message { 
      max-width: 80%; 
      padding: 10px 14px; 
      border-radius: 12px; 
      font-size: 15px; 
      line-height: 1.4;
      position: relative;
    }
    
    .msg-bot { 
      align-self: flex-start; 
      background-color: var(--bot-msg-bg); 
      color: #000;
      border-top-left-radius: 2px;
    }
    
    .msg-user { 
      align-self: flex-end; 
      background-color: var(--user-msg-bg); 
      color: var(--user-msg-text);
      border-top-right-radius: 2px;
    }

    .typing-indicator { display: none; align-self: flex-start; background: white; padding: 10px 15px; border-radius: 12px; margin-bottom: 10px; }
    .dot { height: 6px; width: 6px; background-color: #bbb; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; margin: 0 2px; }
    .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    
    /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ */
    .input-area { 
      background: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; 
      border-top: 1px solid #ddd; margin-bottom: env(safe-area-inset-bottom);
    }
    input[type="text"] { flex: 1; padding: 12px 15px; border-radius: 20px; border: 1px solid #E0E0E0; font-size: 16px; outline: none; background: #F9FAFB; transition: border 0.2s; }
    input[type="text"]:focus { border-color: #5D9CEC; background: white; }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .btn-circle {
      width: 44px; height: 44px; border-radius: 50%; border: none; 
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      transition: transform 0.1s, background-color 0.2s;
      flex-shrink: 0;
    }
    .btn-circle:active { transform: scale(0.95); }
    
    #sendBtn { background-color: var(--user-msg-bg); color: white; box-shadow: 0 2px 5px rgba(93, 156, 236, 0.3); }
    
    /* –ö–Ω–æ–ø–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ */
    #micBtn { background-color: #F0F2F5; color: #5D9CEC; }
    #micBtn.recording { background-color: #EF5350; color: white; animation: pulse 1.5s infinite; }
    
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 83, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0); } }
    input[type="text"] { flex: 1; padding: 12px 15px; border-radius: 20px; border: 1px solid #E0E0E0; font-size: 16px; outline: none; background: #F9FAFB; transition: border 0.2s; }
    input[type="text"]:focus { border-color: #5D9CEC; background: white; }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .btn-circle {
      width: 44px; height: 44px; border-radius: 50%; border: none; 
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      transition: transform 0.1s, background-color 0.2s;
      flex-shrink: 0;
    }
    .btn-circle:active { transform: scale(0.95); }
    
    #sendBtn { background-color: var(--user-msg-bg); color: white; box-shadow: 0 2px 5px rgba(93, 156, 236, 0.3); }
    
    /* –ö–Ω–æ–ø–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ */
    #micBtn { background-color: #F0F2F5; color: #5D9CEC; }
    #micBtn.recording { background-color: #EF5350; color: white; animation: pulse 1.5s infinite; }
    
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 83, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0); } }
    input[type="text"] { flex: 1; padding: 12px 15px; border-radius: 20px; border: 1px solid #E0E0E0; font-size: 16px; outline: none; background: #F9FAFB; transition: border 0.2s; }
    input[type="text"]:focus { border-color: #5D9CEC; background: white; }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .btn-circle {
      width: 44px; height: 44px; border-radius: 50%; border: none; 
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      transition: transform 0.1s, background-color 0.2s;
      flex-shrink: 0;
    }
    .btn-circle:active { transform: scale(0.95); }
    
    #sendBtn { background-color: var(--user-msg-bg); color: white; box-shadow: 0 2px 5px rgba(93, 156, 236, 0.3); }
    
    /* –ö–Ω–æ–ø–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ */
    #micBtn { background-color: #F0F2F5; color: #5D9CEC; }
    #micBtn.recording { background-color: #EF5350; color: white; animation: pulse 1.5s infinite; }
    
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 83, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0); } }
    input[type="text"] { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; font-size: 16px; outline: none; }
    button#sendBtn { background-color: var(--user-msg-bg); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

    /* --- –ö–û–ù–¢–ï–ù–¢ (–í–∏–¥–µ–æ/–ú—É–∑—ã–∫–∞) --- */
    .content-list { padding: 20px; overflow-y: auto; flex: 1; background: #F9FAFB; }
    .media-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .media-icon { width: 45px; height: 45px; background: #F0F2F5; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #5D9CEC; }
    .media-info h3 { font-size: 15px; margin-bottom: 3px; color: #333; }
    .media-info p { font-size: 12px; color: #888; }
    .play-btn { margin-left: auto; color: #5D9CEC; }

   /* --- –ò–ì–†–ê (–î–´–•–ê–ù–ò–ï - –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù) --- */
    #game-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã */
      background: linear-gradient(180deg, #FFFFFF 0%, #F0F4F8 100%);
      padding: 20px;
      text-align: center;
      position: relative;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫—Ä—É–≥–∞ */
    .breath-container {
      position: relative;
      width: 300px;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 50px;
    }

    /* –§–æ–Ω–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞ (–≠—Ñ—Ñ–µ–∫—Ç —Ä—è–±–∏) */
    .breath-ripple {
      position: absolute;
      border-radius: 50%;
      border: 1px solid rgba(93, 156, 236, 0.1);
      background: rgba(93, 156, 236, 0.05);
      width: 100%;
      height: 100%;
      transform: scale(0.8);
      opacity: 0;
      transition: all 4s ease-in-out;
      z-index: 1;
    }

    /* –ì–ª–∞–≤–Ω—ã–π –∫—Ä—É–≥ */
    .breath-circle {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      /* –ö—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏ —Ç–µ–Ω—å */
      background: linear-gradient(135deg, #E2E8F0 0%, #FFFFFF 100%);
      box-shadow: 
        0 10px 30px rgba(0,0,0,0.05),
        inset 0 0 20px rgba(255,255,255,0.8);
      transform: scale(1);
      transition: all 4s cubic-bezier(0.4, 0.0, 0.2, 1); /* –ë–æ–ª–µ–µ –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
    }

    /* –¢–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –∫—Ä—É–≥–∞ */
    .breath-text {
      color: #546E7A;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1px;
      transition: opacity 0.3s;
    }

    /* --- –°–æ—Å—Ç–æ—è–Ω–∏—è –ê–Ω–∏–º–∞—Ü–∏–∏ --- */
    
    /* 1. –í–î–û–• (–†–∞—Å—Ç–µ–º –∏ –≥–æ–ª—É–±–µ–µ–º) */
    .state-inhale .breath-circle {
      transform: scale(1.3); /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± */
      background: linear-gradient(135deg, #89C4F4 0%, #5D9CEC 100%);
      box-shadow: 0 20px 50px rgba(93, 156, 236, 0.4); /* –°–∏–ª—å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
    }
    .state-inhale .breath-text { color: white; }
    
    .state-inhale .breath-ripple {
      transform: scale(1.5);
      opacity: 1;
      border-color: rgba(93, 156, 236, 0.2);
    }

    /* 2. –ó–ê–î–ï–†–ñ–ö–ê (–î–µ—Ä–∂–∏–º —Ü–≤–µ—Ç –∏ —Ä–∞–∑–º–µ—Ä) */
    .state-hold .breath-circle {
      transform: scale(1.3);
      background: linear-gradient(135deg, #4FC3F7 0%, #29B6F6 100%);
      box-shadow: 0 20px 50px rgba(41, 182, 246, 0.3);
    }
    .state-hold .breath-text { color: white; }
    .state-hold .breath-ripple { transform: scale(1.6); opacity: 0.5; }

    /* 3. –í–´–î–û–• (–£–º–µ–Ω—å—à–∞–µ–º—Å—è) */
    .state-exhale .breath-circle {
      transform: scale(1);
      background: linear-gradient(135deg, #E2E8F0 0%, #F5F7FA 100%);
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    .state-exhale .breath-text { color: #546E7A; }
    .state-exhale .breath-ripple { transform: scale(0.8); opacity: 0; }

    /* –¢–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–¥ –∫—Ä—É–≥–æ–º */
    .instruction-text {
      font-size: 22px;
      color: #2C3E50;
      height: 40px;
      margin-bottom: 40px;
      font-weight: 600;
      opacity: 0.8;
      transition: opacity 0.5s;
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .game-controls {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .btn-game {
      padding: 16px 32px;
      border-radius: 50px;
      border: none;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .btn-start {
      background: linear-gradient(135deg, #5D9CEC 0%, #4A89DC 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(93, 156, 236, 0.3);
    }
    .btn-start:active { transform: scale(0.95); }

    .btn-stop {
      background: #FFCDD2;
      color: #C62828;
    }

    .btn-reset {
      background: white;
      color: #90A4AE;
      width: 54px;
      height: 54px;
      padding: 0;
      justify-content: center;
      border-radius: 50%;
    }

  </style>
</head>
<body>

  <!-- –®–ê–ü–ö–ê –í–ù–£–¢–†–ï–ù–ù–Ø–Ø -->
  <header id="main-header">
    <button id="back-btn" onclick="goBack()">
      <span class="material-icons-round">arrow_back</span>
      <span class="header-title" id="page-title">–ù–∞–∑–∞–¥</span>
    </button>
  </header>

  <!-- –≠–ö–†–ê–ù 1: –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
  <div id="menu-screen" class="screen active">
    
    <!-- –ë–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è (–ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É, –±–µ–ª—ã–π) -->
    <div class="profile-section">
      <div class="profile-placeholder-img"></div>
      <div class="profile-info">
        <h2>–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞</h2>
        <p>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –ü—Å–∏—Ö–æ–ª–æ–≥ ‚Ä¢ –û–Ω–ª–∞–π–Ω</p>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div class="menu-list">
      
      <!-- –ß–∞—Ç (–°–∏–Ω–∏–π —Ñ–æ–Ω, –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç) -->
      <div class="menu-card card-chat" onclick="navigateTo('chat')">
        <div class="icon-circle">
          <span class="material-icons-round">chat_bubble_outline</span>
        </div>
        <div class="menu-content">
          <h3>–ß–∞—Ç —Å –ü—Å–∏—Ö–æ–ª–æ–≥–æ–º</h3>
          <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏, —è –∑–¥–µ—Å—å</p>
        </div>
      </div>

      <!-- –ú–µ–¥–∏—Ç–∞—Ü–∏–∏ (–ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω) -->
      <div class="menu-card card-video" onclick="navigateTo('video')">
        <div class="icon-circle">
          <span class="material-icons-round">spa</span>
        </div>
        <div class="menu-content">
          <h3>–ú–µ–¥–∏—Ç–∞—Ü–∏–∏</h3>
          <p>–ê—É–¥–∏–æ –¥–ª—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏</p>
        </div>
      </div>

      <!-- –î—ã—Ö–∞–Ω–∏–µ (–°–µ—Ä—ã–π —Ñ–æ–Ω) -->
      <div class="menu-card card-game" onclick="navigateTo('game')">
        <div class="icon-circle">
          <span class="material-icons-round">air</span>
        </div>
        <div class="menu-content">
          <h3>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ü—Ä–∞–∫—Ç–∏–∫–∏</h3>
          <p>–¢–µ—Ö–Ω–∏–∫–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ç—Ä–µ–≤–æ–≥–∏</p>
        </div>
      </div>

      <!-- –î–Ω–µ–≤–Ω–∏–∫ (–ë–µ–ª—ã–π —Ñ–æ–Ω, –ø–æ—á—Ç–∏ –±–µ–ª—ã–π) -->
      <div class="menu-card card-music" onclick="navigateTo('music')">
        <div class="icon-circle">
          <span class="material-icons-round">favorite_border</span>
        </div>
        <div class="menu-content">
          <h3>–î–Ω–µ–≤–Ω–∏–∫ –≠–º–æ—Ü–∏–π</h3>
          <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</p>
        </div>
      </div>

    </div>
  </div>

  <!-- –≠–ö–†–ê–ù 2: –ß–ê–¢ -->
  <div id="chat-screen" class="screen">
    <div id="chat-container">
      <div class="message msg-bot">
        –ü—Ä–∏–≤–µ—Ç! –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –≤—ã—Å–ª—É—à–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å. –ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–π—á–∞—Å? üåø
      </div>
      <div class="typing-indicator" id="typing">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>
    <div class="input-area">
      <button id="micBtn" class="btn-circle">
        <span class="material-icons-round">mic</span>
      </button>
      <input type="text" id="userInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
      <button id="sendBtn" class="btn-circle">
        <span class="material-icons-round">send</span>
      </button>
    </div>
  </div>

  <!-- –≠–ö–†–ê–ù 3: –í–ò–î–ï–û (–ú–µ–¥–∏—Ç–∞—Ü–∏–∏) -->
  <div id="video-screen" class="screen">
    <div class="content-list">
      <div class="media-item">
        <div class="media-icon"><span class="material-icons-round">spa</span></div>
        <div class="media-info">
          <h3>–î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞</h3>
          <p>5 –º–∏–Ω—É—Ç —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è</p>
        </div>
        <span class="material-icons-round play-btn">play_arrow</span>
      </div>
      <div class="media-item">
        <div class="media-icon"><span class="material-icons-round">waves</span></div>
        <div class="media-info">
          <h3>–®—É–º –º–æ—Ä—è</h3>
          <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–Ω–∞</p>
        </div>
        <span class="material-icons-round play-btn">play_arrow</span>
      </div>
    </div>
  </div>

  <!-- –≠–ö–†–ê–ù 4: –ò–ì–†–ê (–î–´–•–ê–ù–ò–ï) -->
  <div id="game-screen" class="screen">
    
    <div class="breath-container" id="breathContainer">
      <!-- –î–æ–±–∞–≤–∏–ª–∏ –¥–≤–∞ –∫–æ–ª—å—Ü–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "—ç—Ö–æ" -->
      <div class="breath-ripple" style="transition-delay: 0.1s"></div>
      <div class="breath-ripple" style="transition-delay: 0.2s"></div>
      
      <div class="breath-circle" id="breathCircle">
        <span class="breath-text" id="breathLabel">Relax</span>
      </div>
    </div>

    <div class="instruction-text" id="breathInstruction">
      –ù–∞–∂–º–∏ –°—Ç–∞—Ä—Ç
    </div>

    <div class="game-controls">
      <button class="btn-game btn-start" id="breathStartBtn" onclick="toggleBreathing()">
        <span class="material-icons-round" id="playIcon">play_arrow</span>
        <span id="playText">–°—Ç–∞—Ä—Ç</span>
      </button>
      
      <button class="btn-game btn-reset" onclick="resetBreathing()">
        <span class="material-icons-round">refresh</span>
      </button>
    </div>

  </div>

  <!-- –≠–ö–†–ê–ù 5: –ú–£–ó–´–ö–ê (–î–Ω–µ–≤–Ω–∏–∫) -->
  <div id="music-screen" class="screen">
    <div class="content-list">
      <div class="media-item">
        <div class="media-icon"><span class="material-icons-round">music_note</span></div>
        <div class="media-info">
          <h3>Lo-Fi Relax</h3>
          <p>–î–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
        <span class="material-icons-round play-btn">play_arrow</span>
      </div>
    </div>
  </div>

  <script>
    // –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–Æ –°–°–´–õ–ö–£ –ò–ó GOOGLE APPS SCRIPT
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzOq4mO0Dgx9PH9AzH8ozKOYcQ0CshNHldt51VyynuR1uJZ8ZW_x71KNhG-4QV6nPF8/exec";

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.BackButton.onClick(goBack);

    // --- UI –≠–õ–ï–ú–ï–ù–¢–´ ---
    const screens = {
      menu: document.getElementById('menu-screen'),
      chat: document.getElementById('chat-screen'),
      video: document.getElementById('video-screen'),
      music: document.getElementById('music-screen'),
      game: document.getElementById('game-screen')
    };

    const header = document.getElementById('main-header');
    const pageTitle = document.getElementById('page-title');
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
    const breathCircle = document.getElementById('breathCircle');
    const breathLabel = document.getElementById('breathLabel');
    const breathInstruction = document.getElementById('breathInstruction');
    const playIcon = document.getElementById('playIcon');
    const playText = document.getElementById('playText');
    const breathStartBtn = document.getElementById('breathStartBtn');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–∞—Ç–∞
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const typingIndicator = document.getElementById('typing');
    const userId = tg.initDataUnsafe?.user?.id || 'test_user_' + Math.floor(Math.random() * 1000);

    // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
    function navigateTo(screenName) {
      Object.values(screens).forEach(el => el.classList.remove('active'));
      screens[screenName].classList.add('active');

      if (screenName === 'menu') {
        header.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —à–∞–ø–∫—É —Å –∫–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥ –≤ –º–µ–Ω—é
        tg.BackButton.hide();
      } else {
        header.style.display = 'flex'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–ø–∫—É –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–æ–≤
        tg.BackButton.show();
        
        if (screenName === 'chat') {
           pageTitle.innerText = '–ß–∞—Ç —Å –ü—Å–∏—Ö–æ–ª–æ–≥–æ–º';
           setTimeout(scrollToBottom, 100);
        }
        else if (screenName === 'video') pageTitle.innerText = '–ú–µ–¥–∏—Ç–∞—Ü–∏–∏';
        else if (screenName === 'music') pageTitle.innerText = '–î–Ω–µ–≤–Ω–∏–∫ –≠–º–æ—Ü–∏–π';
        else if (screenName === 'game') pageTitle.innerText = '–î—ã—Ö–∞–Ω–∏–µ';
      }
    }

    function goBack() {
      if(screens.game.classList.contains('active')) {
        resetBreathing();
      }
      navigateTo('menu');
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    let breathInterval = null;
    let breathTimer = 0;
    let isBreathing = false;
    const INHALE_TIME = 4;
    const HOLD_TIME = 7;
    const EXHALE_TIME = 8;

    function toggleBreathing() {
      if (isBreathing) stopBreathing();
      else startBreathing();
    }

    function startBreathing() {
      isBreathing = true;
      playIcon.innerText = 'pause';
      playText.innerText = '–ü–∞—É–∑–∞';
      breathStartBtn.classList.remove('btn-start');
      breathStartBtn.classList.add('btn-stop');
      
      breathInterval = setInterval(() => {
        breathTimer++;
        updateBreathVisuals();
      }, 1000);
      updateBreathVisuals();
    }

    function stopBreathing() {
      isBreathing = false;
      clearInterval(breathInterval);
      breathInterval = null;
      playIcon.innerText = 'play_arrow';
      playText.innerText = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
      breathStartBtn.classList.add('btn-start');
      breathStartBtn.classList.remove('btn-stop');
    }

    function resetBreathing() {
      stopBreathing();
      breathTimer = 0;
      
      playText.innerText = '–°—Ç–∞—Ä—Ç';
      playIcon.innerText = 'play_arrow'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É Play
      breathStartBtn.classList.remove('btn-stop');
      breathStartBtn.classList.add('btn-start');
      
      // –°–±—Ä–æ—Å –≤–∏–∑—É–∞–ª–∞
      const container = document.getElementById('breathContainer');
      if (container) container.classList.remove('state-inhale', 'state-hold', 'state-exhale');
      
      breathLabel.innerText = 'Relax';
      breathInstruction.innerText = '–ù–∞–∂–º–∏ –°—Ç–∞—Ä—Ç';
    }

    function updateBreathVisuals() {
      const cycleTime = breathTimer % (INHALE_TIME + HOLD_TIME + EXHALE_TIME);
      
      // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —á—Ç–æ–±—ã –º–µ–Ω—è—Ç—å –∫–ª–∞—Å—Å—ã —É –≤—Å–µ–≥–æ –±–ª–æ–∫–∞
      const container = document.getElementById('breathContainer');
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
      container.classList.remove('state-inhale', 'state-hold', 'state-exhale');

      if (cycleTime < INHALE_TIME) {
        // –í–î–û–•
        container.classList.add('state-inhale');
        breathLabel.innerText = '–í–¥–æ—Ö';
        breathInstruction.innerText = '–ì–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö –Ω–æ—Å–æ–º...';
      } 
      else if (cycleTime < INHALE_TIME + HOLD_TIME) {
        // –ó–ê–î–ï–†–ñ–ö–ê
        container.classList.add('state-hold');
        breathLabel.innerText = '–î–µ—Ä–∂–∏';
        breathInstruction.innerText = '–ó–∞–¥–µ—Ä–∂–∏ –¥—ã—Ö–∞–Ω–∏–µ...';
      } 
      else {
        // –í–´–î–û–•
        container.classList.add('state-exhale');
        breathLabel.innerText = '–í—ã–¥–æ—Ö';
        breathInstruction.innerText = '–ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã–¥–æ—Ö —Ä—Ç–æ–º...';
      }
    }

    // --- –õ–û–ì–ò–ö–ê –ß–ê–¢–ê ---
    function scrollToBottom() {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addMessage(text, isUser = false) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message');
      msgDiv.classList.add(isUser ? 'msg-user' : 'msg-bot');
      msgDiv.innerHTML = text.replace(/\n/g, '<br>');
      chatContainer.insertBefore(msgDiv, typingIndicator);
      scrollToBottom();
    }

    function showTyping(show) {
      typingIndicator.style.display = show ? 'block' : 'none';
      scrollToBottom();
    }

    // --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò ---
    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage(text, true);
      userInput.value = '';
      sendBtn.disabled = true;
      showTyping(true);

      // –í–∞–∂–Ω–æ: credentials: 'omit' —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É "Load failed" –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö
      fetch(GOOGLE_SCRIPT_URL + '?act=api', {
        method: 'POST',
        mode: 'cors',
        credentials: 'omit', 
        redirect: "follow",
        body: JSON.stringify({ text: text, userId: userId })
      })
      .then(response => {
        if (!response.ok) throw new Error('Server error: ' + response.status);
        return response.json();
      })
      .then(data => {
        showTyping(false);
        sendBtn.disabled = false;
        userInput.focus();
        
        if (data.status === 'success') {
          addMessage(data.text, false);
          if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        } else {
          addMessage("‚ö†Ô∏è " + data.text, false);
        }
      })
      .catch(error => {
        showTyping(false);
        sendBtn.disabled = false;
        console.error('Error:', error);
        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –ø—Ä–æ—Å–∏–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π
        addMessage("‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Deploy –≤ Google Script (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 'Anyone' –∏ 'Me').", false);
      });
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
    window.visualViewport.addEventListener('resize', () => {
       if(screens.chat.classList.contains('active')) scrollToBottom();
    });
// --- –ì–û–õ–û–°–û–í–û–ô –í–í–û–î –ò –ê–£–î–ò–û–ü–õ–ï–ï–† ---
    const micBtn = document.getElementById('micBtn');
    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;
    let globalStream = null; 
    let currentAudio = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–≤—É–∫–∞

    micBtn.addEventListener('click', async () => {
      if (!isRecording) {
        startRecording();
      } else {
        stopRecording();
      }
    });

    async function startRecording() {
      // 1. –ï—Å–ª–∏ –±–æ—Ç —á—Ç–æ-—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç - –∑–∞—Ç—ã–∫–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
      stopCurrentAudio();

      try {
        if (!globalStream || !globalStream.active) {
            globalStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        }

        mediaRecorder = new MediaRecorder(globalStream);
        audioChunks = [];

        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = sendVoiceMessage;

        mediaRecorder.start();
        isRecording = true;
        
        micBtn.classList.add('recording');
        micBtn.innerHTML = '<span class="material-icons-round">stop</span>';
        
        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        
        userInput.placeholder = "–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞...";
        userInput.disabled = true;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:", err);
        addMessage("‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.", false);
        globalStream = null;
      }
    }

    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        
        micBtn.classList.remove('recording');
        micBtn.innerHTML = '<span class="material-icons-round">mic</span>';
        
        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');

        userInput.placeholder = "–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ...";
        userInput.disabled = false;
      }
    }

    function sendVoiceMessage() {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const reader = new FileReader();
      
      showTyping(true);
      
      reader.readAsDataURL(audioBlob);
      reader.onloadend = () => {
        const base64Audio = reader.result;
        
        addMessage("üé§ <i>–ê—É–¥–∏–æ—Å–æ–æ–±—â–µ–Ω–∏–µ...</i>", true);

        fetch(GOOGLE_SCRIPT_URL + '?act=api', {
          method: 'POST',
          mode: 'cors',
          credentials: 'omit',
          redirect: "follow",
          body: JSON.stringify({ userId: userId, audio: base64Audio })
        })
        .then(response => response.json())
        .then(data => {
          showTyping(false);
          if (data.status === 'success') {
            if (data.recognizedText) {
               addMessage("üó£ " + data.recognizedText, true); 
            }
            
            addMessage(data.text, false);
            
            if (data.audio) {
               playAudioResponse(data.audio);
            }
          } else {
            addMessage("‚ö†Ô∏è " + data.text, false);
          }
        })
        .catch(err => {
          showTyping(false);
          addMessage("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞—É–¥–∏–æ.", false);
        });
      };
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–≤—É–∫–∞
    function stopCurrentAudio() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0; // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –≤ –Ω–∞—á–∞–ª–æ
        currentAudio = null;
      }
    }

    function playAudioResponse(base64Audio) {
       // –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë, —á—Ç–æ –∏–≥—Ä–∞–ª–æ –¥–æ —ç—Ç–æ–≥–æ
       stopCurrentAudio();

       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø–ª–µ–µ—Ä
       currentAudio = new Audio("data:audio/mp3;base64," + base64Audio);
       
       currentAudio.play().catch(e => {
           console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:", e);
           // –ï—Å–ª–∏ –∞–≤—Ç–æ–ø–ª–µ–π –∑–∞–ø—Ä–µ—â–µ–Ω, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É Play (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
       });
       
       // –ö–æ–≥–¥–∞ –∞—É–¥–∏–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
       currentAudio.onended = () => {
         currentAudio = null;
       };
    }
  </script>
</body>
</html>
